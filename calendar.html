<!doctype html>
<html lang="sv">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Calendar</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    <div id="include-header"></div>

    <main class="container py-4">
      <h1 data-i18n="calendar.title">Parish Calendar</h1>
      <p data-i18n="calendar.intro">Upcoming liturgies and events.</p>
      <div class="mb-3">
  <div class="ratio ratio-16x9">
    <iframe
      id="gcal"
      data-base-src="https://calendar.google.com/calendar/embed?src=879f7dc660496c5013f132b95eb0f0b9e71471304b4c879338072473ceddbbc4%40group.calendar.google.com&ctz=Europe%2FStockholm"
      src="https://calendar.google.com/calendar/embed?src=879f7dc660496c5013f132b95eb0f0b9e71471304b4c879338072473ceddbbc4%40group.calendar.google.com&ctz=Europe%2FStockholm"
      style="border:0"
      frameborder="0"
      scrolling="no"
      loading="lazy">
    </iframe>
  </div>
</div>

    </main>

    <div id="include-footer"></div>

    <script src="/assets/js/i18n.js"></script>
    <script src="/assets/js/include.js"></script>
    
  <script>
(function () {
  function mapLang(l) { return l === 'sr' ? 'sr' : (l === 'sv' ? 'sv' : 'en'); }

  function rebuildCalendar() {
    var wrap = document.getElementById('gcal-wrap');
    if (!wrap) return;

    var base = wrap.getAttribute('data-base-src');
    var lang = document.documentElement.lang || localStorage.getItem('lang') || 'sv';

    try {
      var url = new URL(base);
      url.searchParams.set('hl', mapLang(lang));
      url.searchParams.set('v', String(Date.now())); // cache bust

      var ratio = wrap.querySelector('.ratio');
      if (!ratio) return;

      // Replace the iframe so it reloads with the new language
      ratio.innerHTML = '';
      var iframe = document.createElement('iframe');
      iframe.setAttribute('style', 'border:0');
      iframe.setAttribute('frameborder', '0');
      iframe.setAttribute('scrolling', 'no');
      iframe.setAttribute('loading', 'lazy');
      iframe.src = url.toString();
      ratio.appendChild(iframe);
    } catch (e) {
      console.error('Calendar rebuild failed:', e);
    }
  }

  // Build once on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', rebuildCalendar);
  } else {
    rebuildCalendar();
  }

  // Rebuild whenever site language changes
  if (window.__setLang) {
    const orig = window.__setLang;
    window.__setLang = async function (lang) {
      await orig(lang);
      rebuildCalendar();
    };
  }
})();
</script>

  


  </body>
</html>
