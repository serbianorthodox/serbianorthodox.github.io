<!doctype html>
<html lang="sv">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Donations</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/site.f3c51a6396.css">
    <style>
      /* Keep the generated QR SVG inside its column and fluid */
      #swish-qr { max-width: 160px; }
      #swish-qr svg { display: block; width: 100%; height: auto; }
      /* Prevent long strings from forcing horizontal scroll */
      #swish-info .card-text { overflow-wrap: anywhere; }
    </style>
  </head>
  <body>
    <div id="include-header"></div>

    <main class="container py-4">
      <h1 class="mb-3" data-i18n="donations.title">Donations</h1>
      <p class="lead mb-4" data-i18n="donations.intro">Support the parish with a one-time or monthly gift.</p>

      <div class="row g-3">
        <!-- Swish (one-time) -->
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-body">
              <div class="row g-3 align-items-start">
                <!-- Left: Swish text/info -->
                <div class="col-12 col-md-7" id="swish-info">
                  <h5 class="card-title" data-i18n="donations.swish.title">Swish (one-time)</h5>
                  <p class="card-text mb-1">
                    <strong data-i18n="donations.swish.number.label">Swish number:</strong>
                    <span class="ms-1" data-i18n="donations.swish.number.value">123 446 7320</span>
                    <button type="button" class="btn btn-sm btn-outline-secondary ms-2"
                            data-copy="123 446 7320" data-i18n="common.copy">Copy</button>
                  </p>
                  <p class="card-text" data-i18n="donations.swish.note">Enter your name in the message field.</p>
                </div>

                <!-- Right: QR (desktop/tablet only) -->
                <div class="col-12 col-md-5 d-none d-md-block">
                  <section class="p-3 border rounded-3 bg-white h-100">
                    <h6 class="mb-2" data-i18n="donations.swish.title">Swish (one-time)</h6>
                    <!-- EMPTY so i18n fills it -->
                    <p class="text-muted mb-3 small" data-i18n="donations.swish_qr_optional_hint"></p>
                    <div id="swish-qr" aria-label="Swish QR"></div>
                    <noscript><p class="text-danger">Enable JavaScript to see the Swish QR code.</p></noscript>
                  </section>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Monthly donation (Autogiro) -->
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title" data-i18n="donations.autogiro.title">Monthly donation (Autogiro)</h5>

              <p class="card-text mb-1">
                <strong data-i18n="donations.bank.name.label">Bank:</strong>
                <span class="ms-1" data-i18n="donations.bank.name.value">Swedbank</span>
              </p>
              <p class="card-text mb-1">
                <strong data-i18n="donations.bank.account.label">Account number:</strong>
                <span class="ms-1" data-i18n="donations.bank.account.value"></span>
                <button type="button" class="btn btn-sm btn-outline-secondary ms-2"
                        data-copy="email to: svestenik@crkva.se" data-i18n="common.copy">Copy</button>
              </p>
              <p class="card-text mb-1">
                <strong data-i18n="donations.bank.ocr.label">Reference:</strong>
                <span class="ms-1" data-i18n="donations.bank.ocr.value">Your name</span>
              </p>
              <p class="card-text" data-i18n="donations.bank.amount">Choose your payment amount.</p>

              <p class="text-muted small mb-0" data-i18n="donations.bank.note">
                For recurring payments, set up an Autogiro with your bank using the details above.
              </p>
            </div>
          </div>
        </div>
      </div>

      <p class="mt-3 text-muted small" data-i18n="donations.note">
        Thank you for supporting the life of the Church.
      </p>
    </main>

    <div id="include-footer"></div>

    <!-- Order matters: i18n + includes, then QR lib, then our script -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/i18n.js"></script>
    <script src="/assets/js/include.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

    <script>
      // Run after everything is parsed and libs are loaded.
      window.addEventListener('load', function () {
        try {
          var payeeRaw = "123 446 7320";
          var payee = (payeeRaw || "").replace(/\s+/g, "");
          // Swish payload: C<payee>;<amount>;<message>;<lock_mask>
          var payload = "C" + payee + ";;;" + "6"; // amount and message editable

          var target = document.getElementById("swish-qr");
          if (target && window.QRCode && typeof QRCode.toString === "function") {
            QRCode.toString(payload, { type: "svg", margin: 1 }, function (err, svg) {
              if (err) { console.error(err); return; }
              target.innerHTML = svg;
              var svgEl = target.querySelector('svg');
              if (svgEl) {
                svgEl.setAttribute('role', 'img');
                svgEl.setAttribute('aria-label', 'Swish QR code');
              }
              // Re-apply translations so late DOM and empty nodes get filled
              var reapplyFns = ["applyTranslations","i18nApply","translatePage","translate"];
              for (var i = 0; i < reapplyFns.length; i++) {
                var fn = reapplyFns[i];
                if (typeof window[fn] === "function") {
                  try { window[fn](); } catch (e) { console.warn(fn + " failed:", e); }
                }
              }
            });
          } else {
            console.warn("QR target or library missing.");
          }
        } catch (e) {
          console.error(e);
        }
      });

      // Localized Copy buttons (defensive)
      (function () {
        function byId(id, fallback) {
          var el = document.getElementById(id);
          return el ? (el.textContent || "").trim() : fallback;
        }
        function flash(btn, text) {
          var original = btn.textContent;
          btn.textContent = text;
          btn.disabled = true;
          setTimeout(function () {
            btn.textContent = original;
            btn.disabled = false;
          }, 1200);
        }
        document.addEventListener('click', function (e) {
          var btn = e.target.closest && e.target.closest('button[data-copy]');
          if (!btn) return;
          var value = btn.getAttribute('data-copy') || "";
          function success() { flash(btn, byId('i18n-copied', 'Copied!')); }
          function fail() { flash(btn, byId('i18n-failed', 'Failed')); }
          if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(value).then(success, fail);
          } else {
            try {
              var ta = document.createElement('textarea');
              ta.value = value;
              ta.style.position = 'fixed';
              ta.style.left = '-9999px';
              document.body.appendChild(ta);
              ta.focus();
              ta.select();
              document.execCommand('copy');
              document.body.removeChild(ta);
              success();
            } catch (_) { fail(); }
          }
        });
      })();
    </script>

    <!-- Localized copy helper strings (hidden, used by the copy script) -->
    <span id="i18n-copy" class="d-none" data-i18n="common.copy">Copy</span>
    <span id="i18n-copied" class="d-none" data-i18n="common.copied">Copied!</span>
    <span id="i18n-failed" class="d-none" data-i18n="common.failed">Failed</span>
  </body>
</html>
